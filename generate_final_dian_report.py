#!/usr/bin/env python3
"""
Script final para generar reporte DIAN en el formato exacto requerido
"""

import sys
from pathlib import Path

# Add the taxbot directory to the path
sys.path.append(str(Path(__file__).parent))

from taxbot.dian_report_generator import generate_professional_dian_report

def main():
    """Generate the final DIAN report in the exact required format."""
    print("üèõÔ∏è  GENERADOR FINAL DE REPORTE DIAN")
    print("=" * 60)
    print("Generando reporte profesional de conceptos DIAN...")
    print("Formato: Fecha | Tema | Concepto + Resumen + An√°lisis")
    print("=" * 60)
    
    # Generate report for 2025 concepts (20 conceptos)
    report_file = generate_professional_dian_report(
        csv_path="taxbot/data/conceptos_dian.csv",
        max_conceptos=20,
        year_filter="2025"
    )
    
    if report_file:
        print(f"\n‚úÖ REPORTE GENERADO EXITOSAMENTE")
        print(f"üìÅ Archivo: {report_file}")
        print(f"üìç Ubicaci√≥n: {Path(report_file).absolute()}")
        
        # Show summary of what was generated
        with open(report_file, 'r', encoding='utf-8') as f:
            content = f.read()
            lines = content.split('\n')
            
        print(f"\nüìä RESUMEN DEL REPORTE:")
        print(f"   ‚Ä¢ Total de l√≠neas: {len(lines)}")
        print(f"   ‚Ä¢ Conceptos procesados: {len([l for l in lines if l.startswith('-')])}")
        print(f"   ‚Ä¢ Tama√±o del archivo: {len(content):,} caracteres")
        
        print(f"\nüéØ CARACTER√çSTICAS DEL REPORTE:")
        print(f"   ‚úÖ Formato cronol√≥gico por fecha")
        print(f"   ‚úÖ Res√∫menes profesionales generados por IA")
        print(f"   ‚úÖ An√°lisis t√©cnicos detallados")
        print(f"   ‚úÖ Compatible con base de datos")
        print(f"   ‚úÖ Estructura: Fecha | Tema | Concepto")
        
        print(f"\nüìã PRIMEROS CONCEPTOS DEL REPORTE:")
        print("-" * 50)
        concept_lines = [l for l in lines if l.startswith('-')]
        for i, line in enumerate(concept_lines[:5], 1):
            print(f"{i}. {line}")
        if len(concept_lines) > 5:
            print(f"   ... y {len(concept_lines) - 5} conceptos m√°s")
        
        print(f"\nüöÄ EL SISTEMA EST√Å LISTO PARA USAR")
        print(f"   ‚Ä¢ Ejecuta: python generate_final_dian_report.py")
        print(f"   ‚Ä¢ Modifica max_conceptos para m√°s/menos conceptos")
        print(f"   ‚Ä¢ Cambia year_filter para otros a√±os")
        
    else:
        print("‚ùå Error generando el reporte")
        return 1
    
    return 0

if __name__ == "__main__":
    exit(main())